$font-family-base: -apple-system, BlinkMacSystemFont, sans-serif;
$font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
  "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji",
  "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji" !default;
$xxsm-break: 300px;
$xsm-break: 320px;

$grid-breakpoints: (
  xs: 0,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
);
$xs-break: map-get($grid-breakpoints, "xs");
$sm-break: map-get($grid-breakpoints, "sm");
$md-break: map-get($grid-breakpoints, "md");
$lg-break: map-get($grid-breakpoints, "lg");
$xl-break: map-get($grid-breakpoints, "xl");
$xxl-break: "1440px";
$xxxl-break: "1600px";

@mixin themify($theme) {
  @if $theme == "day" {
    @content;
  } @else if $theme == "night" {
    .dark & {
      @content;
    }
  }
}

@mixin clearfix() {
  &::after {
    display: block;
    clear: both;
    content: "";
  }
}

.markdown-view {
  @include clearfix();

  word-break: break-word !important;
  overflow-wrap: break-word;
  overflow-x: auto;

  br {
    font-size: 100%;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-weight: 700;
    line-height: 1.65;
    margin: 0 0 0.7em 0;
    font-family: $font-family-base;
  }

  h1 del,
  h1 s,
  h1 strike,
  h2 del,
  h2 s,
  h2 strike,
  h3 del,
  h3 s,
  h3 strike,
  h4 del,
  h4 s,
  h4 strike,
  h5 del,
  h5 s,
  h5 strike,
  h6 del,
  h6 s,
  h6 strike {
    text-decoration: line-through;
  }

  del,
  s,
  strike {
    text-decoration: line-through;
    text-decoration-thickness: auto;
  }

  h1 del,
  h1 s,
  h1 strike,
  h2 del,
  h2 s,
  h2 strike,
  h3 del,
  h3 s,
  h3 strike,
  h4 del,
  h4 s,
  h4 strike,
  h5 del,
  h5 s,
  h5 strike,
  h6 del,
  h6 s,
  h6 strike {
    text-decoration: line-through;
  }

  h1 {
    font-size: 22px;

    @media (min-width: $md-break) {
      font-size: 28px;
    }
  }

  h2 {
    font-size: 20px;
    font-weight: bold;

    @media (min-width: $md-break) {
      font-size: 24px;
    }
  }

  h3 {
    font-size: 18px;

    @media (min-width: $md-break) {
      font-size: 20px;
    }
  }

  h4 {
    font-size: 16px;

    @media (min-width: $md-break) {
      font-size: 18px;
    }
  }

  h5 {
    font-size: 14px;
    @media (min-width: $md-break) {
      font-size: 16px;
    }
  }

  blockquote {
    padding-left: 10px;
    border-left-width: 4px;
    border-left-style: solid;

    @include themify(day) {
      @apply text-gray-warm;
      @apply border-l-gray-warm-025;
    }

    @include themify(night) {
      @apply text-blue-dusky-2;
      @apply border-blue-dusky-2-007;
    }

    p {
      margin: 0;
    }
  }

  p {
    line-height: 1.55;
    margin: 0 0 1em 0;
    text-rendering: optimizeLegibility;
  }

  ul li,
  ol li {
    line-height: 150%;
    margin: 0 0 1rem 0;
  }

  img {
    max-width: 100%;
  }

  a {
    @apply text-blue-dark-sky;
  }

  hr {
    clear: both;
    margin: 10px auto;
    border-top-width: 0;
    border-bottom: 1px solid #ccc;
  }

  table {
    word-break: normal !important;
    overflow-x: auto;
    display: block;
    width: fit-content;
    max-width: 100%;

    @apply border dark:border-gray-700 overflow-hidden table-auto border-collapse text-xs sm:text-sm md:text-base;

    tr {
      @apply [&:last-child>td]:border-b-0 [&:nth-child(even)]:bg-light-200 dark:[&:nth-child(even)]:bg-dark-300;
    }

    td {
      @apply border-b border-r dark:border-gray-700 last:border-r-0 p-1 sm:p-2;
    }

    th {
      @apply border-b dark:border-gray-700 text-left font-[500] bg-gray-100 dark:bg-dark-200 text-sm text-gray-700 dark:text-white border-r last:border-r-0 sm:text-sm md:text-base p-1 sm:p-2;
    }
  }

  :not(pre) code {
    padding: 0.2em 0.3em;
    border-radius: 6px;
  }

  p + pre,
  h1 + pre,
  h2 + pre,
  h3 + pre,
  h4 + pre,
  h5 + pre {
    margin-top: 0.5rem;
  }

  ol {
    list-style: circle;
    padding-left: 40px;
  }

  ul {
    list-style: inherit;
    padding-left: 40px;
  }

  pre {
    overflow-x: auto;
    font-size: 18px;
    padding: 15px;
    font-family: $font-family-sans-serif;
    margin: 1.5rem 0;

    @include themify(day) {
      border: 1px solid;
      @apply border-light-500;
    }

    @include themify(night) {
      border: 1px solid #30363d;
    }
  }

  code {
    font-size: 0.875rem;
  }

  pre,
  code {
    @include themify(day) {
      @apply bg-light-600;
      @apply text-gray-charcoal;

      .ll-nam {
        @apply text-gray-charcoal;
      }
      .ll-key {
        color: rgb(207, 34, 46);
      }
      .ll-str {
        color: rgb(17, 99, 41);
      }
      .ll-com {
        color: rgb(110, 119, 129);
      }
      .ll-pct {
        color: rgb(5, 80, 174);
      }
      .ll-num {
        color: rgb(149, 56, 0);
      }
      .ll-rex {
        color: rgb(130, 80, 223);
      }
    }

    @include themify(night) {
      background: #283241;
      @apply text-silver;

      .ll-nam {
        @apply text-silver;
      }
      .ll-key {
        color: rgb(255, 123, 114);
      }
      .ll-str {
        color: rgb(126, 231, 135);
      }
      .ll-com {
        color: rgb(139, 148, 158);
      }
      .ll-pct {
        color: rgb(121, 192, 255);
      }
      .ll-num {
        color: rgb(255, 166, 87);
      }
      .ll-rex {
        color: rgb(210, 168, 255);
      }
    }
  }

  .phishy {
    display: inline;
    @apply text-red-020;
  }

  .text-justify {
    text-align: justify;
  }

  .pull-left,
  .pull-right {
    @media (min-width: $md-break) {
      max-width: calc(50% - 10px);
      padding-left: 10px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
  }

  .pull-left {
    @media (min-width: $md-break) {
      margin-right: 10px;
      padding-right: 10px;
      float: left;
    }
  }

  .pull-right {
    @media (min-width: $md-break) {
      margin-left: 10px;
      padding-right: 10px;
      float: right;
    }
  }

  .markdown-external-link,
  .markdown-post-link,
  .markdown-author-link,
  .markdown-tag-link,
  .markdown-community-link,
  .markdown-witnesses-link {
    cursor: pointer;
  }



  // ============================================
  // ALL VIDEO PLATFORMS - Unified Styling
  // ============================================
  .markdown-video-link-youtube,
  .markdown-video-link-speak,
  .markdown-video-link-vimeo,
  .markdown-video-link-twitch,
  .markdown-video-link-loom,
  .markdown-video-link-bitchute,
  .markdown-video-link-rumble,
  .markdown-video-link-brighteon,
  .markdown-video-link-dtube {
    position: relative;
    display: block;
    width: 100%;
    padding-bottom: 56.25%; // 16:9 aspect ratio
    height: 0;
    overflow: hidden;
    margin: 1rem auto 0.5rem; // Center the video with reduced bottom margin
    background-color: #000;
    cursor: pointer;
    line-height: 0; // Eliminate text-based spacing
    font-size: 0; // Eliminate font-based spacing
    vertical-align: top;

    // All child elements absolutely positioned within container
    .video-thumbnail,
    .markdown-video-play,
    .ecency-renderer-youtube-extension-frame,
    .ecency-renderer-speak-extension-frame {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .video-thumbnail {
      z-index: 1;
      object-fit: contain;
      background-color: #000;
      margin: 0;
      padding: 0;
    }

    .markdown-video-play {
      z-index: 2;
      background: url(play-icon.svg) center center no-repeat;
      background-size: 64px;
      pointer-events: none;
    }

    .ecency-renderer-youtube-extension-frame,
    .ecency-renderer-speak-extension-frame {
      z-index: 3; // On top when video plays
      display: block;
      margin: 0;
      padding: 0;
      line-height: 0;
    }

    // Embedded iframes
    .youtube-shorts-iframe,
    .speak-iframe,
    iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      margin: 0;
      padding: 0;
      display: block; // Remove inline element descender space
      vertical-align: top;
    }
  }

  // 3Speak auto-detected portrait videos (3:4 aspect ratio)
  .markdown-video-link-speak.speak-portrait {
    padding-bottom: 0;
    aspect-ratio: 3 / 4;
    height: auto;
    max-width: 450px;
  }

  // 3Speak auto-detected square videos (1:1 aspect ratio)
  .markdown-video-link-speak.speak-square {
    padding-bottom: 0;
    aspect-ratio: 1 / 1;
    height: auto;
    max-width: 600px;
  }

  // Portrait embeds (9:16 aspect ratio)
  // Target iframe.portrait-embed since the class is applied to iframe elements, not anchors
  iframe.portrait-embed {
    max-width: 360px;
    width: 100%;
    aspect-ratio: 9 / 16; // Modern CSS approach for 9:16 portrait
    height: auto;
    margin-left: auto;
    margin-right: auto;
    display: block;
  }

  // Fallback for any other iframes not caught by specific classes
  iframe:not(.youtube-shorts-iframe):not(.speak-iframe):not(.portrait-embed) {
    max-width: 100% !important;
    display: block;
    aspect-ratio: 16 / 9;
    width: 100%;
    height: auto;
  }

  &.mini-markdown {
    word-wrap: break-word;

    p {
      margin: 0 0 0.6rem 0;

      &:last-child {
        margin-bottom: 0.2rem;
      }
    }

    h1 {
      font-size: 20px;
      margin: 6px 0;
    }

    h2 {
      font-size: 18px;
      margin: 4px 0 4px 0;
    }

    h3 {
      font-size: 16px;
      margin: 4px 0 4px 0;
    }

    ul li,
    ol li {
      font-size: 16px;
    }

    // img {
    //   @media (min-width: $md-break) {
    //     width: 100%;
    //     max-width: 400px;
    //   }
    // }

    .markdown-video-link {
      max-width: 240px;
      width: 100%;
      // Maintain 16:9 aspect ratio even in mini mode
      padding-bottom: 56.25%;
      height: 0;
    }
  }

  .unsupported-iframe {
    font-style: italic;
    margin: 10px 0;
  }
}
